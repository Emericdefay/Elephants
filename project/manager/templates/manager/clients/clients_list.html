{% load static humanize index %}

<style> 
    /* 
    Generic Styling, for Desktops/Laptops 
    */
    table {
      width: 100%;
      border-collapse: collapse;
    }



    th {
      background: #333;
      color: white;
      font-weight: bold;
    }

    td, th {
      padding: 6px;
      border: 1px solid #ccc;
      text-align: center;
    }

    /* 
    Max width before this PARTICULAR table gets nasty
    This query will take effect for any screen smaller than 760px
    and also iPads specifically.
    */
    @media only screen and (max-width: 760px), (min-device-width: 768px) and (max-device-width: 1024px) {
      .responsive-table-input-matrix {
        display: block;
        position: relative;
        width: 100%;
      }
      .responsive-table-input-matrix:after {
        clear: both;
        content: "";
        display: block;
        font-size: 0;
        height: 0;
        visibility: hidden;
      }
      .responsive-table-input-matrix tbody {
        display: block;
        overflow-x: auto;
        position: relative;
        white-space: nowrap;
        width: auto;
      }
      .responsive-table-input-matrix tbody tr {
        display: inline-block;
        vertical-align: top;
      }
      .responsive-table-input-matrix tbody tr td {
        display: block;
        text-align: center;
      }
      .responsive-table-input-matrix tbody tr td:first-child {
        text-align: center;
      }
      .responsive-table-input-matrix thead {
        display: block;
        float: left;
        margin-right: 10px;
      }
      .responsive-table-input-matrix thead:after {
        clear: both;
        content: "";
        display: block;
        font-size: 0;
        height: 0;
        visibility: hidden;
      }
      .responsive-table-input-matrix thead th:first-of-type {
        height: 1.4em;
      }
      .responsive-table-input-matrix thead th {
        display: block;
        text-align: center;
      }
      .responsive-table-input-matrix thead th:first-child {
        text-align: center;
      }
    }
</style>

<style>
  .draggable-grip{
    vertical-align: middle;
  }

  .draggable-grip:after {
    width: 3%;
    position: relative;
    text-align: center;
    content: '\f58d';
    font-family: 'Font Awesome\ 5 Free';
    font-weight: 900;
  }
</style>

<style>


  

  

</style>


    <h3>
        Clients
        <button
          class="btn btn-success align-content-center mx-3 unique-add-btn"
          type="button"
          id="createClient"
          >
          Ajouter
        </button>
    </h3>
    {% regroup clients by circuit as client_list %}
      {% for circuit, clients_by_circuit in client_list %}
        <table class="responsive-table-input-matrix table table-hover" id="table-{{forloop.counter0}}">
            <thead class="table-dark position-relative" {% if forloop.counter0 > 0 %} style="visibility:collapse;"{% else %}style="z-index:1; opacity:1;"{% endif %}>
                <tr>
                    <th>Nom</th>
                    <th>Adresse</th>
                    <th>Tel</th>
                    {% with foodcategories as foodcategories %}
                    {% for food in formDefaultCommand %}
                        <th  style="width: 0px;" class="verticalTableHeader">
                                    {{ food.default.category }}
                        </th>
                        {% endfor %}
                    {% endwith %}
                    <th style="width: 0px;" >Tournée</th>
                    <th>€/u</th>
                    <th>Nb. Repas</th>
                    <th>€ ce mois</th>
                    {% comment %} <th>Export</th> {% endcomment %}
                </tr>
            </thead>
          
          <tbody class="overflow-auto">
            {% ifchanged clients_by_circuit.circuit %}
              {% if forloop.counter0 != 0 %}
                <tr style="border-collapse: separate; border-spacing:0 20px;">
                  <td colspan="17">
                  </td>
                </tr>
              {% endif %}
            {% endifchanged %}
          {% for client in clients_by_circuit %}
            <tr style="background-color: ; margin-bottom:1rem; background-color:{{gradients|get_value:circuit.id}}">
                <td style="vertical-align: middle;">
                  <input type="text" data-client="{{client.id}}" data-attrib="last_name" class="input_last_name" style="inline-size: -webkit-fill-available;" name="last_name__{{client.id}}" id="last_name__{{client.id}}" value="{{client.last_name}}"/></br>
                  <input type="text" data-client="{{client.id}}" data-attrib="first_name" class="input_first_name" style="inline-size: -webkit-fill-available;" name="first_name__{{client.id}}" id="first_name__{{client.id}}" value="{{client.first_name}}"/>
                </td>
                <td style="vertical-align: middle;">
                  <input type="text" data-client="{{client.id}}" data-attrib="address" class="input_address" style="inline-size: -webkit-fill-available;" name="address__{{client.id}}" id="address__{{client.id}}" value="{{client.address}}"/><br>
                  <input type="text" data-client="{{client.id}}" data-attrib="postcode" class="input_postcode" style="inline-size: -webkit-fill-available;" name="postcode__{{client.id}}" id="postcode__{{client.id}}" value="{{client.postcode}}"/><br>
                  <input type="text" data-client="{{client.id}}" data-attrib="address_details" class="input_address_details" style="inline-size: -webkit-fill-available;" name="address_details__{{client.id}}" id="address_details__{{client.id}}" value="{{client.address_details}}"/>
                </td>
                <td style="vertical-align: middle;">
                  <input type="text" data-client="{{client.id}}" data-attrib="cellphone" class="input_cellphone" style="inline-size: -webkit-fill-available;" name="cellphone__{{client.id}}" id="cellphone__{{client.id}}" value="{{client.cellphone}}"/><br>
                  <input type="text" data-client="{{client.id}}" data-attrib="cellphone2" class="input_cellphone2" style="inline-size: -webkit-fill-available;" name="cellphone2__{{client.id}}" id="cellphone2__{{client.id}}" value="{{client.cellphone2}}"/>
                </td>
                {% for default in formDefaultCommand %}
                    <td style="-webkit-writing-mode: vertical-lr;">
                        <input
                            class="checkbox-default-food"
                            type="checkbox"
                            data-client="{{client.id}}"
                            data-food="{{default.id}}"
                            style="transform: scale(2); vertical-align: sub;"
                            id="_meals__{{default.id}}__{{client.id}}"
                            name="_meals__{{default.id}}__{{client.id}}"
                        {% for box_client in client.client_command.all %}
                            {% if default|striptags == box_client|striptags %}
                                checked
                            {% endif %}
                        {% endfor %}
                            class="default_box">
                    </td>
                {% endfor %}
                <td style="vertical-align: middle;">
                    <select name="circuit_id__{{client.id}}" id="circuit_id__{{client.id}}">
                        {% for circuit in circuits %}
                            <option value="{{ circuit.id }}" {% if circuit.id == client.circuit.id %}selected="selected"{% endif %}> {{ circuit.name }} </option>
                        {% endfor %}
                    </select>
                </td>
                <td style="vertical-align: middle;">
                  {% if client.client_command.all|make_unit_price %}
                    <strong>{{client.client_command.all|make_unit_price}}</strong>
                  {% else %}
                    <strong>0</strong>
                  {% endif %}
                </td>
                {% with actual_day as day %}
                {% with day|day as this_day %}
                {% with day|month as this_month %}
                {% with day|year as this_year %}
                <td style="vertical-align: middle;">
                  <strong>{{month_commands|make_query|query_filter_month_date_command:this_month|query_filter_year_date_command:this_year|query_filter_client_id:client.id|query_sum_meals_this_month}}</strong>
                </td>
                <td style="vertical-align: middle;">
                  {% if month_commands|make_query|query_filter_month_date_command:this_month|query_filter_year_date_command:this_year|query_filter_client_id:client.id|query_sum_price_this_month %}
                    <strong>{{month_commands|make_query|query_filter_month_date_command:this_month|query_filter_year_date_command:this_year|query_filter_client_id:client.id|query_sum_price_this_month}}</strong>
                  {% else %}
                    <strong>0</strong>
                  {% endif %}
                </td>
                {% endwith %}
                {% endwith %}
                {% endwith %}
                {% endwith %}
                {% comment %} <td><button
                  class="btn btn-warning align-content-center mx-3"
                  type="button">
                  Excel à l'unitée
                </button></td> {% endcomment %}
            </tr>
            {% endfor %}
          </table>
          {% endfor %}
