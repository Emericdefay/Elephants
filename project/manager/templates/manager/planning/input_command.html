{% load static humanize index %}

{% comment %} Init some variables {% endcomment %}
{% now "d" as to_day %}
{% now "Y" as to_year %}
{% now "m" as to_month %}
{% now "d" as todays_date %}
    <div class="btn-group" role="group">
        <div class="input-group-prepend">
            <button class="btn btn-outline-dark btn-minus" type="button">
                <i class="fa fa-minus"></i>
            </button>
        </div>
        <input
            class="form-control btn-check quantity"
            min="0"
            type="number"
            id="command_command__{{day_time}}__{{command_id}}__{{client.id}}"
            name="command_command__{{day_time}}__{{command_id}}__{{client.id}}"
            value={{day_time_command}}
        >
        <label class="btn mx-0 p-0 quantity_label" for="command_command__{{day_time}}__{{command_id}}__{{client.id}}">
            <button 
                type="button" 
                class="btn 
                {% if command_opts.comment and command_opts.comment != '' and command_opts.comment != 'None' %}
                    btn-danger
                {% elif day_time_command > 0 %}
                    btn-warning
                {% else %}
                    btn-outline-light
                {% endif %}
                dropdown-toggle"
                data-bs-toggle="dropdown"
                aria-expanded="false"
            >
                {{day_time_command}}
            </button>
            <div class="dropdown-menu">
                <table>
                    <thead>
                        {% with foodcategories as foodcategories %}
                        {% for food in formDefaultCommand %}
                            <th class="verticalTableHeader">
                                {{food.default.category}}
                            </th>
                        {% endfor %}
                        {% endwith %}
                    </thead>
                    <tbody>
                        {% if day_time_command !=  0 %}
                            {% for food in formDefaultCommand %}
                                <td>
                                    <input
                                    type="checkbox"
                                    data-id="{{food.id}}"
                                    data-food="{{food.id}}"
                                    data-command="{{command_id}}"
                                    id="meals__{{food.id}}__{{day_time}}__{{command_id}}__{{client.id}}"
                                    name="meals__{{food.id}}__{{day_time}}__{{command_id}}__{{client.id}}"
                                        {% if command_client|make_query|query_command_id:command_id|query_command_food:food > 0 %}
                                            checked
                                        {% endif %}
                                    class="default_box checkbox-food"
                                    style="vertical-align: -webkit-baseline-middle;
                                    transform: scale(2.1);">
                                </td>
                            {% endfor %}
                        {% else %}
                            {% for default in formDefaultCommand %}
                                <td style="-webkit-writing-mode: vertical-lr;">
                                    <input
                                        type="checkbox"
                                        data-food="{{food.id}}"
                                        data-command="{{command_id}}"
                                        id="meals__{{default.id}}__{{day_time}}__{{command_id}}__{{client.id}}"
                                        name="meals__{{default.id}}__{{day_time}}__{{command_id}}__{{client.id}}"
                                        {% for box_client in default_command.all %}
                                            {% if default|striptags == box_client|striptags %}
                                                checked
                                            {% endif %}
                                        {% endfor %}
                                        class="default_box checkbox-food"
                                        style="vertical-align: -webkit-baseline-middle;
                                        transform: scale(2.1);">
                                </td>
                            {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
                <table>
                    <tbody>
                        <tr>
                            <td>
                                <label class="mx-0 p-0" for="comment__{{day_time}}__{{command_id}}__{{client.id}}">Commentaire</label>
                                <input
                                    type="text"
                                    min="0"
                                    step="0.05"
                                    id="comment__{{day_time}}__{{command_id}}__{{client.id}}"
                                    name="comment__{{day_time}}__{{command_id}}__{{client.id}}"
                                    value="{% if command_opts.comment %}{{command_opts.comment}}{% endif %}"
                                    style="width:{{width_cells}}px;"
                                    class="default_box">
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </label>
        <div class="input-group-append">
            <button class="btn btn-outline-dark btn-plus" type="button">
                <i class="fa fa-plus"></i>
            </button>
        </div>
    </div>
